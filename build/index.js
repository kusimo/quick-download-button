(()=>{"use strict";const e=window.wp.element,t=window.wp.blocks,a=window.wp.primitives,o=window.wp.i18n,n=window.wp.blockEditor,l=window.wp.components,d=(window.wp.coreData,window.wp.data,(0,e.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(a.Path,{d:"M18 11.3l-1-1.1-4 4V3h-1.5v11.3L7 10.2l-1 1.1 6.2 5.8 5.8-5.8zm.5 3.7v3.5h-13V15H4v5h16v-5h-1.5z"})));(0,t.registerBlockType)("quick-download-button/download-button",{title:(0,o.__)("Download Button","quick-download-button"),icon:d,description:(0,o.__)("Use download button for your file download link.","quick-download-button"),category:"widgets",keywords:[(0,o.__)("download","quick-download-button"),(0,o.__)("button","quick-download-button")],attributes:{downloadTitle:{type:"string",source:"text",selector:"button",default:(0,o.__)("Download","quick-download-button")},downloadTitlePlaceholder:{type:"string",source:"attribute",selector:"button",attribute:"title",default:(0,o.__)("Download","quick-download-button")},downloadPageId:{type:"string",source:"attribute",selector:"button",attribute:"data-page-id",default:qdbu_data.download_page_id},downloadAttachmentId:{type:"string",source:"attribute",selector:"button",attribute:"data-attachment-id"},downloadFormat:{type:"string",source:"attribute",selector:"p.up i",attribute:"class",default:"fi fi-file"},downloadFileSize:{type:"string",source:"text",selector:"p.down",default:(0,o.__)("File size","quick-download-button")},downloadWaitTime:{type:"string",source:"attribute",selector:"button",attribute:"data-wait-time",default:0},externalUrl:{type:"string",source:"attribute",selector:"button",attribute:"data-external-url"},waitDuration:{type:"string",source:"attritube",selector:"button",attribute:"data-wait-duration",default:"0"},waitMessage:{type:"string",source:"attribute",selector:"button",attribute:"data-msg"},spinnerValue:{type:"string",source:"attribute",selector:"button",attribute:"data-spinner"},useExternalLink:{type:Boolean,source:"attribute",selector:"button",attribute:"ext",default:!1},backgroundColor:{type:"string"},haveExternal:{type:"boolean",default:!1},targetBlank:{type:"boolean",default:!1},haveManualTimer:{type:"boolean",default:!1},pID:{type:"string",source:"attribute",selector:"button",attribute:"data-id"}},edit:t=>{const{attributes:{downloadTitle:a,downloadFileSize:i,downloadPageId:r,downloadAttachmentId:u,downloadFormat:s,downloadTitlePlaceholder:c,haveExternal:w,haveManualTimer:b,targetBlank:m,externalUrl:p,waitDuration:g,waitMessage:_,spinnerValue:k,backgroundColor:h,pID:E},setAttributes:v,className:f}=t,y=e=>!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e),x=w?(0,e.createElement)(l.TextControl,{label:(0,o.__)(y(p)?"Enter URL (Url is valid)":"Enter URL (*Provide a valid URL)","quick-download-button"),help:(0,o.__)("Don't use external URL if the file is located on your site. Double click on the download icon to upload file.","quick-download-button"),value:p,onChange:e=>{v({externalUrl:e}),y(p)&&updateMetaValue(p)}}):"",q=parseInt(k)>0?(0,e.createElement)(l.TextControl,{label:(0,o.__)("Message to the user","quick-download-button"),value:_,placeholder:(0,o.__)("Please wait...","quick-download-button"),onChange:e=>{v({waitMessage:e})}}):"",C=b?(0,e.createElement)(l.__experimentalNumberControl,{isShiftStepEnabled:!0,shiftStep:1,step:1,value:parseInt(k),onChange:e=>{v({spinnerValue:e})}}):"";return[(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:(0,o.__)("Color settings","quick-download-button")},(0,e.createElement)("div",{className:"components-base-control"},(0,e.createElement)("div",{className:"component-base-control__field"},(0,e.createElement)("label",{className:"components-base-control__label qdbu-editor-label"},(0,o.__)("Background color","quick-download-button")),(0,e.createElement)(n.ColorPalette,{value:t.backgroundColor,onChange:e=>{v({backgroundColor:e})}})))),(0,e.createElement)(l.PanelBody,{title:(0,o.__)("URL settings","quick-download-button")},(0,e.createElement)("div",{className:"components-base-control"},(0,e.createElement)("div",{className:"component-base-control__field"},(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Open link in new window?","quick-download-button"),help:m?(0,o.__)("Open the download link in a new window. This will try to open link in new tab when possible.","quick-download-button"):(0,o.__)("Open in same window. This will open link in same window when possible.","quick-download-button"),checked:m,onChange:e=>{v({targetBlank:e})}}),(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Use External URL?","quick-download-button"),help:w?(0,o.__)("Use external URL.","quick-download-button"):(0,o.__)("Do not use External URL. Please double click the download icon to upload file from your site.","quick-download-button"),checked:w,onChange:e=>{v({haveExternal:e}),!1===w&&v({externalUrl:""})}}),x))),(0,e.createElement)(l.PanelBody,{title:(0,o.__)("Countdown settings","quick-download-button")},(0,e.createElement)("div",{className:"components-base-control"},(0,e.createElement)("div",{className:"component-base-control__field qdbu-label-mtop"},(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Manual","quick-download-button"),help:b?(0,o.__)("Enter timer manually.","quick-download-button"):(0,o.__)("Select one of the default timer durations.","quick-download-button"),checked:b,onChange:e=>{v({haveManualTimer:e})}}),C,(0,e.createElement)(l.RadioControl,{label:(0,o.__)("Timer","quick-download-button"),help:(0,o.__)("The amount of time in seconds you want the user to wait before the download begins. Default is 0.","quick-download-button"),selected:k,options:[{label:"0",value:"0",key:"0"},{label:"10",value:"10",key:"10"},{label:"15",value:"15",key:"15"},{label:"20",value:"20",key:"20"},{label:"25",value:"25",key:"25"},{label:"30",value:"30",key:"30"},{label:"60",value:"60",key:"60"}],onChange:e=>{v({spinnerValue:e})}}),q)))),(0,e.createElement)("div",{className:`${f} button--download`},(0,e.createElement)("div",{className:w?"custom-download-button-inner ext-link":"custom-download-button-inner"},(0,e.createElement)("button",{className:"g-btn f-l position-relative shadow",type:"button",title:c,"data-attachment-id":u,"data-page-id":r,"data-post-id":"","data-have-external":w,"data-external-url":`${t.attributes.haveExternal?t.attributes.externalUrl:""}`,"data-target":m,"data-wait-duration":g,"data-spinner":k,"data-msg":_,"data-id":E,onSubmit:e=>{e.preventDefault()}},(0,e.createElement)(n.RichText,{placeholder:(0,o.__)("Download","quick-download-button"),onChange:e=>{v({downloadTitle:e}),v({downloadTitlePlaceholder:e}),v({downloadWaitTime:"0"}),""!==postId&&null!==postId&&v({pID:postId})},value:a})),(0,e.createElement)("p",{className:"up",style:{background:h}},(0,e.createElement)("i",{className:s}),(0,e.createElement)(n.MediaUpload,{onSelect:e=>{v({downloadFileSize:e.filesizeHumanReadable});let t=parseInt(e.id)+parseInt(r);e.url,v({downloadAttachmentId:t}),v({downloadPageId:qdbu_data.download_page_id});let a=e.url.substr(e.url.lastIndexOf(".")+1).trim();!0===["jpg","jpeg","tiff","png","bmp","gif"].includes(a.toLowerCase())&&v({downloadFormat:"fi fi-image"});let o=["pdf","mp3","mov","zip","txt","doc","xml","mp4","ppt","csv"];if(!0===o.includes(a.toLowerCase())){let e=o.indexOf(a),t=o[`${e}`];v({downloadFormat:"fi fi-"+t})}},value:t.attributes.downloadUrl,render:t=>{let{open:a}=t;return(0,e.createElement)(l.Button,{className:"custom-download-logo__button",onClick:a,icon:d,showTooltip:"true",label:(0,o.__)("Upload File.","quick-download-button")})}})),(0,e.createElement)("p",{className:"down",style:{background:h}},(0,e.createElement)("i",{className:"fi-folder-o"}),i)))]},save:t=>{const{attributes:a}=t;return(0,e.createElement)("div",{className:"button--download"},(0,e.createElement)("div",{className:a.haveExternal?"custom-download-button-inner ext-link":"custom-download-button-inner"},(0,e.createElement)("button",{className:"g-btn f-l position-relative shadow",type:"button","data-attachment-id":a.downloadAttachmentId,"data-page-id":a.downloadPageId,"data-post-id":"","data-have-external":a.haveExternal,"data-external-url":`${a.haveExternal?a.externalUrl:""}`,"data-wait-duration":t.attributes.waitDuration,"data-target-blank":a.targetBlank,"data-msg":a.waitMessage,"data-spinner":a.spinnerValue,"data-id":a.pID,title:a.downloadTitlePlaceholder},(0,e.createElement)(n.RichText.Content,{value:a.downloadTitle})),(0,e.createElement)("p",{className:"up",style:{background:a.backgroundColor}},(0,e.createElement)("i",{className:a.downloadFormat})),(0,e.createElement)("p",{className:"down",style:{background:a.backgroundColor}},(0,e.createElement)("i",{className:"fi-folder-o"}),t.attributes.downloadFileSize)))}})})();